import React, { useState } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line, Doughnut } from 'recharts';
import { Star, Users, TrendingUp, AlertTriangle } from 'lucide-react';

const FrozenFoodAnalysis = () => {
  const [expandedTribe, setExpandedTribe] = useState(null);
  const [expandedFactor, setExpandedFactor] = useState(null);

  const productData = {
    name: "Ben & Jerry's Chunky Monkey",
    image: "üç¶",
    category: "Premium Ice Cream",
    overallRating: 4.3,
    totalReviews: 15647,
    description: "Banana Ice Cream with Fudge Chunks & Walnuts"
  };

  const topTribes = [
    { id: 1, name: "Health-Conscious Parents", value: 89.2, size: 3420, color: "#8884d8" },
    { id: 2, name: "Dessert Enthusiasts", value: 85.7, size: 4890, color: "#82ca9d" },
    { id: 3, name: "Budget Shoppers", value: 72.4, size: 2680, color: "#ffc658" },
    { id: 4, name: "Texture Lovers", value: 68.9, size: 1950, color: "#ff7c7c" },
    { id: 5, name: "Flavor Purists", value: 61.3, size: 1240, color: "#8dd1e1" }
  ];

  const tribeFactors = {
    1: [
      { factor: "Ingredient Transparency", value: 92.1, mentions: 1205 },
      { factor: "Nutritional Value", value: 87.3, mentions: 980 },
      { factor: "Organic Certification", value: 79.8, mentions: 745 },
      { factor: "Kid-Friendly Appeal", value: 76.2, mentions: 620 },
      { factor: "Portion Size Control", value: 68.9, mentions: 380 }
    ],
    2: [
      { factor: "Taste Quality", value: 94.5, mentions: 2340 },
      { factor: "Texture Experience", value: 89.7, mentions: 1890 },
      { factor: "Brand Reputation", value: 84.2, mentions: 1450 },
      { factor: "Flavor Variety", value: 78.6, mentions: 890 },
      { factor: "Seasonal Availability", value: 65.4, mentions: 450 }
    ]
  };

  const factorDetails = {
    "Ingredient Transparency": [
      { aspect: "Clear Labeling", contribution: 34.2, trend: "positive" },
      { aspect: "Source Information", contribution: 28.7, trend: "positive" },
      { aspect: "Additive Disclosure", contribution: 22.1, trend: "neutral" },
      { aspect: "Allergen Warnings", contribution: 15.0, trend: "negative" }
    ],
    "Taste Quality": [
      { aspect: "Flavor Intensity", contribution: 38.9, trend: "positive" },
      { aspect: "Sweetness Balance", contribution: 31.4, trend: "positive" },
      { aspect: "Aftertaste", contribution: 18.3, trend: "neutral" },
      { aspect: "Artificial Notes", contribution: 11.4, trend: "negative" }
    ]
  };

  const monthlyTrend = [
    { month: 'Jan', value: 78 }, { month: 'Feb', value: 82 }, { month: 'Mar', value: 85 },
    { month: 'Apr', value: 89 }, { month: 'May', value: 87 }, { month: 'Jun', value: 92 }
  ];

  return (
    <div className="w-full min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
      <div className="grid grid-cols-12 gap-4 h-screen">
        
        {/* Left Side - Product Info */}
        <div className="col-span-3 space-y-4">
          <div className="bg-white rounded-lg shadow-lg p-4 h-full">
            <div className="text-center mb-4">
              <div className="text-6xl mb-2">{productData.image}</div>
              <h1 className="text-xl font-bold text-gray-900">{productData.name}</h1>
              <p className="text-sm text-gray-600 mt-1">{productData.description}</p>
            </div>
            <div className="space-y-3">
              <div className="flex items-center justify-center space-x-2">
                <Star className="w-4 h-4 text-yellow-500 fill-current" />
                <span className="font-semibold">{productData.overallRating}</span>
                <span className="text-sm text-gray-500">({productData.totalReviews.toLocaleString()})</span>
              </div>
              <div className="text-center">
                <div className="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium inline-block">
                  {productData.category}
                </div>
              </div>
              <div className="text-xs text-gray-500 text-center">
                Analysis based on user reviews to identify key tribes and their influence factors
              </div>
            </div>
          </div>
        </div>

        {/* Middle - Top 5 Tribes */}
        <div className="col-span-4 space-y-4">
          <div className="bg-white rounded-lg shadow-lg p-4">
            <h2 className="text-lg font-bold text-gray-900 mb-3">Top 5 Tribes</h2>
            <p className="text-xs text-gray-600 mb-4">Tribes extracted from review sentiment analysis showing influence scores</p>
            
            <ResponsiveContainer width="100%" height={280}>
              <BarChart data={topTribes}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" angle={-45} textAnchor="end" height={80} fontSize={10} />
                <YAxis fontSize={10} />
                <Tooltip formatter={(value) => [`${value}%`, 'Influence']} />
                <Bar 
                  dataKey="value" 
                  fill="#8884d8"
                  radius={[2, 2, 0, 0]}
                  onClick={(data) => setExpandedTribe(data.id)}
                  style={{ cursor: 'pointer' }}
                />
              </BarChart>
            </ResponsiveContainer>

            <div className="grid grid-cols-2 gap-2 mt-3">
              {topTribes.slice(0, 4).map((tribe) => (
                <div 
                  key={tribe.id}
                  className={`p-2 rounded border cursor-pointer text-xs ${
                    expandedTribe === tribe.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200'
                  }`}
                  onClick={() => setExpandedTribe(tribe.id)}
                >
                  <div className="font-medium truncate">{tribe.name}</div>
                  <div className="text-lg font-bold">{tribe.value}%</div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Right Side - Expanded Analysis */}
        <div className="col-span-5 space-y-4">
          {expandedTribe && (
            <div className="bg-white rounded-lg shadow-lg p-4">
              <div className="flex items-center space-x-2 mb-3">
                <Users className="w-5 h-5 text-indigo-600" />
                <h2 className="text-lg font-bold text-gray-900">
                  {topTribes.find(t => t.id === expandedTribe)?.name} Analysis
                </h2>
              </div>
              <p className="text-xs text-gray-600 mb-4">Key factors driving this tribe's engagement and satisfaction levels</p>

              {tribeFactors[expandedTribe] && (
                <div className="grid grid-cols-2 gap-4">
                  {/* Doughnut Chart */}
                  <div>
                    <ResponsiveContainer width="100%" height={200}>
                      <PieChart>
                        <Pie
                          data={tribeFactors[expandedTribe]}
                          cx="50%"
                          cy="50%"
                          innerRadius={40}
                          outerRadius={80}
                          dataKey="value"
                          nameKey="factor"
                        >
                          {tribeFactors[expandedTribe].map((entry, index) => (
                            <Cell key={`cell-${index}`} fill={`hsl(${index * 72}, 70%, 60%)`} />
                          ))}
                        </Pie>
                        <Tooltip formatter={(value) => [`${value}%`, 'Score']} />
                      </PieChart>
                    </ResponsiveContainer>
                  </div>

                  {/* Line Chart */}
                  <div>
                    <ResponsiveContainer width="100%" height={200}>
                      <LineChart data={monthlyTrend}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="month" fontSize={10} />
                        <YAxis fontSize={10} />
                        <Tooltip />
                        <Line 
                          type="monotone" 
                          dataKey="value" 
                          stroke="#8884d8" 
                          strokeWidth={2}
                          dot={{ fill: '#8884d8', r: 3 }}
                        />
                      </LineChart>
                    </ResponsiveContainer>
                  </div>
                </div>
              )}

              {/* Factor List */}
              <div className="grid grid-cols-2 gap-2 mt-4">
                {tribeFactors[expandedTribe]?.map((factor, idx) => (
                  <div 
                    key={idx}
                    className={`p-2 rounded border cursor-pointer text-xs ${
                      expandedFactor === factor.factor ? 'border-green-500 bg-green-50' : 'border-gray-200'
                    }`}
                    onClick={() => setExpandedFactor(factor.factor)}
                  >
                    <div className="font-medium truncate">{factor.factor}</div>
                    <div className="text-sm font-bold">{factor.value}%</div>
                    <div className="text-xs text-gray-500">{factor.mentions} mentions</div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Factor Details */}
          {expandedFactor && factorDetails[expandedFactor] && (
            <div className="bg-white rounded-lg shadow-lg p-4">
              <div className="flex items-center space-x-2 mb-3">
                <TrendingUp className="w-5 h-5 text-green-600" />
                <h3 className="text-lg font-bold text-gray-900">{expandedFactor} Breakdown</h3>
              </div>
              <p className="text-xs text-gray-600 mb-4">Detailed analysis of contributing aspects and their impact on success</p>

              <div className="grid grid-cols-2 gap-4">
                {/* Bar Chart for aspects */}
                <div>
                  <ResponsiveContainer width="100%" height={180}>
                    <BarChart data={factorDetails[expandedFactor]} layout="horizontal">
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis type="number" fontSize={9} />
                      <YAxis dataKey="aspect" type="category" width={80} fontSize={9} />
                      <Tooltip formatter={(value) => [`${value}%`, 'Contribution']} />
                      <Bar dataKey="contribution" fill="#82ca9d" radius={[0, 2, 2, 0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>

                {/* Aspect Details */}
                <div className="space-y-2">
                  {factorDetails[expandedFactor].map((aspect, idx) => (
                    <div 
                      key={idx}
                      className={`p-2 rounded border text-xs ${
                        aspect.trend === 'negative' ? 'border-red-200 bg-red-50' : 'border-gray-200'
                      }`}
                    >
                      <div className="font-medium">{aspect.aspect}</div>
                      <div className="flex justify-between items-center">
                        <span className="font-bold">{aspect.contribution}%</span>
                        <div className={`w-2 h-2 rounded-full ${
                          aspect.trend === 'positive' ? 'bg-green-500' :
                          aspect.trend === 'neutral' ? 'bg-yellow-500' : 'bg-red-500'
                        }`}></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Lowest Factor Analysis */}
              {(() => {
                const lowestAspect = factorDetails[expandedFactor].find(d => d.trend === 'negative');
                if (lowestAspect) {
                  return (
                    <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                      <div className="flex items-center space-x-2 mb-2">
                        <AlertTriangle className="w-4 h-4 text-red-600" />
                        <h4 className="font-bold text-sm text-red-900">Lowest Success Contributor</h4>
                      </div>
                      <div className="text-xs">
                        <div className="font-medium text-red-800">{lowestAspect.aspect} ({lowestAspect.contribution}%)</div>
                        <p className="text-red-700 mt-1">
                          This aspect shows negative trend and lowest contribution, indicating primary limitation for tribe satisfaction. 
                          Addressing this could significantly improve overall performance.
                        </p>
                      </div>
                    </div>
                  );
                }
                return null;
              })()}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default FrozenFoodAnalysis;
